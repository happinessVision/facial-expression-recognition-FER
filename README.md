# Facial Emotion Recognition (распознавание эмоций по выражению лица)

<p align="center"><img src="/img/faces.jpg" width="500" alt="FER"></p>

Задача распознавания 9-ти эмоций
- Anger	- гнев;
- Contempt	- презрение;
- Disgust	- отвращение;
- Fear	- страх;
- Happy	- радость;
- Neutral	- безразличие;
- Sad	- грусть;
- Surprise	- удивление;
- Uncertain	- неопределенность.


## Exploratory data analysis (разведочный анализ данных)
Класс SMOTE — это алгоритм предварительной обработки данных, используемый для устранения дисбаланса классов в наборе данных.
инициализируется с параметрами:

- path_folder_train_data   - > путь к исходному набору данных;
- path_save_imgs           - > путь к выходному набору новых данных;
- smote_value              - > количество выходных экземпляров по каждому из классов;
- gen_model                - > модель для аугментаций изображений;
- face_detector            - > объект детектора лиц;
- IMAGE_SIZE               - > размер выходных изображений;
- train_part               - > доля тренировочных данных, которые не будут участвовать в процедуре аугментации;
- modify_coef              - > коэффициент регулирующий процент генераций новых изображений, принимает значения [0,1]

```python
from Builder_tools.Unit_tools import MediaPiPe_detector
from Builder_tools.Augmentation_tools_keras import SMOTE, Generate_img_model

# Определяем детектор лиц в нашем случае это будет MediaPipe
face_detector = MediaPiPe_detector()

# Модель для аугментации изображений
augmentation_model = Generate_img_model()
```

## Задачи, и варианты их реализации
### Классификация
#### Особенности реализации:
- за основу взяты архитектуры нейронных сетей VGGface (ResNet50, VGG16);
- гиперпараметры для полносвязных выходных слоев подобраны с использованием Байесовской оптимизации;
```python
# KERAS_TUNER
from keras_tuner import  Objective, BayesianOptimization

#Класс гипермодели реализован для решения данной задачи
from Builder_tools.Unit_tools import MyHyperModel

```
- генераторы для обучающих данных + аугментации;
- в реализации модели на архитектуре ResNet50 - были разморожены последние 15 слоев;
- в реализации модели на архитектуре VGG16 - были разморожены последние 4 слоя;
- установлен оптимизатор Adam с динамическим изменением скорости обучения ExponentialDecay.

### Регрессия
#### Особенности реализации
- разметка изображений на Valence Arousal проводилась не случайным образом;
- при разметке, каждое изображение преобразовано в изображение с оттенками серого, изменен размер изображения до 48x48,
проведена векторизация;
- применен алгоритм машинного обучения на базе многообразий ISOMAP, изменена размерность изображений до 2-х значений;
- центры кластеров (метки классов) нанесены на координатную плоскость преобразованных изображений, и поэтапно проведен сдвиг данных к центрам их
кластеров.
<p align="center"><img src="/img/V_A.jpg" width="500" alt="FER"></p>
- за основу взята архитектура VGG16, при обучении последние 4 слоя были разморожены;
- установлен оптимизатор Adam с динамическим изменением скорости обучения ExponentialDecay.

## Inference
### Особенности реализации
Класс Inference - предназначен для стыковки основных компонентов проекта, и определения логики инференса.
<p align="center"><img src="/img/Inference.jpg" width="500" alt="FER"></p>
Инициализируется с параметрами:

- model_obj          - > объект модели предсказания эмоций. (По умолчанию наша модель VGG16);
- face_det_obj       - > объект детектирования, и возврата координат лиц. (По умолчанию детектор MediaPiPe_detector);
- draw_box_obj       - > объект отрисовки на изображении результатов предсказания модели. (По умолчанию объект Draw_box);
- IMG_SIZE           - > размер изображения для входа в модель;
- show_state_mode    - > итоговое отображение результата(применяется лишь для infirence_mode = "img"). По умолчанию cv2. Если режим inline (для отображения результата в ноутбуке);
- inference_mode     - > принимает по умолчанию режим "img". 
Предполагает пять режимов инференса:
- "img" - для предсказания и отрисовки на изображениях;
- "img_batch" -для пакетного предсказания на изображениях;
- "video" - для предсказания и отрисовки видео;
- "video_rec" - для предсказания и отрисовки видео c последующим сохранением;
- "online" - для предсказания и отрисовки в онлайн режиме-используя веб камеру.
Примеры инференса содержатся в `Benchmark_&_Inference.ipynb`




